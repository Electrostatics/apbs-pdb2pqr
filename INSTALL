APBS -- Adaptive Poisson-Boltzmann Solver

  Nathan A. Baker (nbaker@wasabi.ucsd.edu)
  Dept. of Chemistry and Biochemistry
  Dept. of Mathematics, Scientific Computing Group
  University of California, San Diego 

  Additional contributing authors listed in the code documentation.

Copyright © 1999. The Regents of the University of California (Regents).
All Rights Reserved. 

Permission to use, copy, modify, and distribute this software and its
documentation for educational, research, and not-for-profit purposes,
without fee and without a signed licensing agreement, is hereby granted,
provided that the above copyright notice, this paragraph and the
following two paragraphs appear in all copies, modifications, and
distributions.

IN NO EVENT SHALL REGENTS BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
REGENTS HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  

REGENTS SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE.  THE SOFTWARE AND ACCOMPANYING DOCUMENTATION, IF
ANY, PROVIDED HEREUNDER IS PROVIDED "AS IS".  REGENTS HAS NO OBLIGATION
TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR
MODIFICATIONS. 
------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+ INTRODUCTION
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Please see the README file for more information

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+ CONTENTS
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
1.  General install instructions for sequential machines
    1.1  Obtaining APBS
    1.2  Prerequisites
    1.3  Recommended directory structure
    1.4  Compilation of the MCtk and PMG prerequisites
    1.5  Compilation of APBS
2. Additional install intructions for parallel machines
3. Platform-specific instructions
    3.1 Intel ix86 processor family with GCC 2.95.1 compiler
    3.2 NPACI IBM RS/6000 Power3 Blue Horizon supercomputer
    3.3 Sun compilers

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+ 1. GENERAL INSTALL INSTRUCTIONS FOR SEQUENTIAL MACHINES
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
========================================================================
1.1 Obtaining APBS
========================================================================
APBS is available from http://wasabi.ucsd.edu/~nbaker/research/pbe.html

========================================================================
1.2 Prerequisites
========================================================================
APBS is built on the Holst research group's MCtk (MC toolkit), available
from http://scicomp.ucsd.edu/~mholst/codes/mctk/index.html.
You will need the MC and MCX components of MCtk.  The PMGC library, available
from http://scicomp.ucsd.edu/~mholst/codes/pmg/index.html, is also required if
uniform-mesh multigrid functionality is desired.  Please read the instructions
below before installing any of these packages.
       
========================================================================
1.3 Recommended directory structure
========================================================================
It is recommended that APBS and the MCtk header files and libraries share a
common install directory.  For the purpose of these instructions, we will
assume that all APBS and MCtk components are installed under the directory
$MANIFOLD.  Un-archive the MCtk and PMGC components into this directory:

      cd $MANIFOLD
      gzip -dc mctk.tar.gz | tar xvf -
      gzip -dc pmgc.tar.gz | tar xvf -

to generate the $MANIFOLD/mctk and $MANIFOLD/pmgc subdirectories.  Also create
a directory for the installation of header files and libraries

      mkdir $MANIFOLD/dist

and set the MC_INCLUDE and MC_LIBRARY environmental variables to this path

      setenv MC_INCLUDE $MANIFOLD/dist/include
      setenv MC_LIBRARY $MANIFOLD/dist/lib

========================================================================
1.4 Compilation of the MCtk and PMGC prerequisites
========================================================================
See the INSTALL files of the individual packages for more information.
Make sure that you have set $MC_INCLUDE and $MC_LIBRARY as indicated above.
You then simply need to configure, build, and install the MCtk and PMGC
packages.

    cd $MANIFOLD/mctk/mc
    ./configure --prefix=${MANIFOLD}/dist --enable-vhack
    make
    make install
    cd $MANIFOLD/mctk/mcx
    ./configure --prefix=${MANIFOLD}/dist 
    make
    make install
    cd $MANIFOLD/pmgc
    ./configure --prefix=${MANIFOLD}/dist 
    make
    make install

If you made a mess and need to start over, simply

    make distclean

========================================================================
1.5 Compilation of APBS
========================================================================
APBS is distributed as a gzipped tar file, "apbs.tgz".  The following command
will unpack APBS into a number of files and subdirectories on any UNIX 
machine (and on any WinNT machine with the GNU-Win32 tools gzip and tar).

    cd $MANIFOLD
    gzip -dc apbs.tar.gz | tar xvf -

You then simply need to configure, build, and install the APBS packages

    cd $MANIFOLD/mctk/apbs
    ./configure --prefix=${MANIFOLD}/dist 
    make
    make install

If PMGC was not installed in the previous steps, the installation will succeed,
but uniform-mesh multigrid support will not available.  If you made a mess and
need to start over, simply

    make distclean

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+ 2. ADDITIONAL INSTALL INSTRUCTIONS FOR PARALLEL MACHINES
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
If you are on a parallel platform and wish to enable the parallel features of
APBS, locate the MPI header file and library directories.  Specifically, find
the directory that contains mpi.h and set the environmental variable
MC_MPI_INCLUDE 

    setenv MC_MPI_INCLUDE (the directory that contains mpi.h)

You need to do the same thing for the libmpi.a library.  Note that for MPICH
MPI distributions, you may actually need to create a symbolic link from
libmpich.a to libmpi.a.  After this directory has been located, set the
environmental variable MC_MPI_LIBRARY

    setenv MC_MPI_LIBRARY (the directory that contains libmpi.a)

The above instructions for compiling MCtk, PMGC, and APBS can then be followed
with one modification.  For _ALL_ packages, the option "--enable-mpi"
must be added to the `./configure` command line.  For example, the new
installation commands for the APBS package would be

    cd $MANIFOLD/mctk/apbs
    ./configure --prefix=${MANIFOLD}/dist --enable-mpi
    make
    make install


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+ 3.  PLATFORM-SPECIFIC INSTRUCTIONS
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
========================================================================
3.1 Intel ix86 processor family with GCC 2.95.1 compiler
========================================================================
For fast(er) production runs, try setting the CC variable before issuing the 
configure commands:

    setenv CC "gcc -O3 -ffast-math -m486 -funroll-loops"

========================================================================
3.2 NPACI IBM RS/6000 Power3 Blue Horizon supercomputer
========================================================================
In all cases, set the CC variable before ./configure:

    setenv CC "mpcc -bmaxdata:0x???????? -bmaxstack:0x10000000 \
                  -L/usr/local/apps/mass -lmass -O3 -qstrict \
                  -qarch=pwr3 -qtune=pwr3 -qmaxmem=-1 -qcache=auto"

Note that the actual command line declaration should contain no line breaks
and continuations; these seem to screw up sed (used by configure) under
AIX.  The bmaxdata linker flag controls the amount of heap the program is
allocated to allocate.  It is a hexadecimal number representing the number
of bytes available.  The NPACI documentation suggests 0x80000000, which
gives 2048 MB of heap space.  While the Blue Horizon nodes do have 8 GB of
memory available per 8-processor node, much of this is taken up by the OS.
In practice, for 8 tasks per node, about 400 MB of heap space is available
to each task (this means OS-related tasks take up nearly 5 GB of memory!) .
In any case, -bmaxdata:0x18000000 seems to be a safe choice as it provides
384 MB heap space per task.

You should also configure MCtk, PMGC, and APBS to use MPI as described above.
Check to make sure the HAVE_MPI_H flag has been set in inc/config.h before
compiling; configure seems to mess up the detection of the headers when
building config.h.  

Finally, since a single electrostatics calculation via APBS requires so little
communication, it makes since to use the IP-based MPI implementation
and thereby allow 8 tasks (processes) per node.  Check the NPACI
documentation for more information on this.

========================================================================
3.3 Sun compilers
========================================================================
Sun compilers are very strange; I have not been able to use them to compile
MCtk/PMGC/APBS.  Use gcc instead:
    
    setenv CC gcc
